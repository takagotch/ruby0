/***
 * Excerpted from "CoffeeScript: Accelerated JavaScript Development, Second Edition",
 * published by The Pragmatic Bookshelf.
 * Copyrights apply to this code. It may not be used to create training material, 
 * courses, books, articles, and the like. Contact us if you are in doubt.
 * We make no guarantees that this code is fit for any purpose. 
 * Visit http://www.pragmaticprogrammer.com/titles/tbcoffee2 for more book information.
***/
'use strict';

var isPlainArray = require('../../is-plain-array')
  , toPosInt     = require('../../../number/to-pos-integer')
  , isObject     = require('../../../object/is-object')

  , isArray = Array.isArray, concat = Array.prototype.concat
  , forEach = Array.prototype.forEach

  , isSpreadable;

isSpreadable = function (value) {
	if (!value) return false;
	if (!isObject(value)) return false;
	if (value['@@isConcatSpreadable'] !== undefined) {
		return Boolean(value['@@isConcatSpreadable']);
	}
	return isArray(value);
};

module.exports = function (item/*, â€¦items*/) {
	var result;
	if (!this || !isArray(this) || isPlainArray(this)) {
		return concat.apply(this, arguments);
	}
	result = new this.constructor(this.length);
	forEach.call(this, function (val, i) { result[i] = val; });
	forEach.call(arguments, function (arg) {
		var base;
		if (isSpreadable(arg)) {
			base = result.length;
			result.length += toPosInt(arg.length);
			forEach.call(arg, function (val, i) { result[base + i] = val; });
			return;
		}
		result.push(arg);
	});
	return result;
};
