/***
 * Excerpted from "CoffeeScript: Accelerated JavaScript Development, Second Edition",
 * published by The Pragmatic Bookshelf.
 * Copyrights apply to this code. It may not be used to create training material, 
 * courses, books, articles, and the like. Contact us if you are in doubt.
 * We make no guarantees that this code is fit for any purpose. 
 * Visit http://www.pragmaticprogrammer.com/titles/tbcoffee2 for more book information.
***/
'use strict';

var strCompare = require('../string/#/case-insensitive-compare')
  , isObject   = require('./is-object')

  , resolve, typeMap;

typeMap = {
	undefined: 0,
	object: 1,
	'boolean': 2,
	string: 3,
	number: 4
};

resolve = function (a) {
	if (isObject(a)) {
		if (typeof a.valueOf !== 'function') return NaN;
		a = a.valueOf();
		if (isObject(a)) {
			if (typeof a.toString !== 'function') return NaN;
			a = a.toString();
			if (typeof a !== 'string') return NaN;
		}
	}
	return a;
};

module.exports = function (a, b) {
	if (a === b) return 0; // Same

	a = resolve(a);
	b = resolve(b);
	if (a == b) return typeMap[typeof a] - typeMap[typeof b]; //jslint: skip
	if (a == null) return -1;
	if (b == null) return 1;
	if ((typeof a === 'string') || (typeof b === 'string')) {
		return strCompare.call(a, b);
	}
	if ((a !== a) && (b !== b)) return 0; //jslint: skip
	return Number(a) - Number(b);
};
